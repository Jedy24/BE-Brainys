<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Capaian Pembelajaran - Chain Select</title>
        <link
            rel="stylesheet"
            href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
        />
        <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    </head>
    <body>
        <div class="container mt-5">
            <h2 class="text-center">Capaian Pembelajaran - Chain Select</h2>
            <form>
                <div class="form-group">
                    <label for="mata-pelajaran">Mata Pelajaran</label>
                    <select id="mata-pelajaran" class="form-control">
                        <option value="">Select Mata Pelajaran</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="fase">Fase</label>
                    <select id="fase" class="form-control" disabled>
                        <option value="">Select Fase</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="element">Element</label>
                    <select id="element" class="form-control" disabled>
                        <option value="">Select Element</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="subelemen">Sub Element</label>
                    <select id="subelemen" class="form-control" disabled>
                        <option value="">Select Sub Element</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="capaian-pembelajaran">Capaian Pembelajaran</label>
                    <textarea id="capaian-pembelajaran" class="form-control" rows="5" readonly></textarea>
                </div>
            </form>
        </div>

        <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
        <script>
            $(document).ready(function () {
                var API_URL = "https://testing.brainys.oasys.id/api";
                // Fetch Mata Pelajaran
                $.ajax({
                    url: API_URL + "/capaian-pembelajaran/mata-pelajaran",
                    method: "POST",
                    success: function (response) {
                        if (response.status === "success") {
                            response.data.forEach(function (item) {
                                $("#mata-pelajaran").append(
                                    new Option(
                                        item.mata_pelajaran,
                                        item.mata_pelajaran
                                    )
                                );
                            });
                        }
                    },
                });

                // Fetch Fase based on Mata Pelajaran
                $("#mata-pelajaran").on("change", function () {
                    let mataPelajaran = $(this).val();
                    $("#fase")
                        .prop("disabled", true)
                        .empty()
                        .append(new Option("Select Fase", ""));

                    if (mataPelajaran) {
                        $.ajax({
                            url: API_URL + "/capaian-pembelajaran/fase",
                            method: "POST",
                            contentType: "application/json",
                            data: JSON.stringify({
                                mata_pelajaran: mataPelajaran,
                            }),
                            success: function (response) {
                                if (response.status === "success") {
                                    $("#fase").prop("disabled", false);
                                    response.data.forEach(function (item) {
                                        $("#fase").append(
                                            new Option(item.fase, item.fase)
                                        );
                                    });
                                }
                            },
                        });
                    }
                });

                // Fetch Element based on Fase
                $("#fase").on("change", function () {
                    let mataPelajaran = $("#mata-pelajaran").val();
                    let fase = $(this).val();
                    $("#element")
                        .prop("disabled", true)
                        .empty()
                        .append(new Option("Select Element", ""));

                    if (mataPelajaran && fase) {
                        $.ajax({
                            url: API_URL + "/capaian-pembelajaran/element",
                            method: "POST",
                            contentType: "application/json",
                            data: JSON.stringify({
                                mata_pelajaran: mataPelajaran,
                                fase: fase,
                            }),
                            success: function (response) {
                                if (response.status === "success") {
                                    $("#element").prop("disabled", false);
                                    response.data.forEach(function (item) {
                                        $("#element").append(
                                            new Option(
                                                item.element,
                                                item.element
                                            )
                                        );
                                    });
                                }
                            },
                        });
                    }
                });

                // Fetch Sub Element based on Element
                $("#element").on("change", function () {
                    let mataPelajaran = $("#mata-pelajaran").val();
                    let fase = $("#fase").val();
                    let element = $(this).val();
                    $("#subelemen")
                        .prop("disabled", true)
                        .empty()
                        .append(new Option("Select Sub Element", ""));

                    if (mataPelajaran && fase && element) {
                        $.ajax({
                            url: API_URL + "/capaian-pembelajaran/subelement",
                            method: "POST",
                            contentType: "application/json",
                            data: JSON.stringify({
                                mata_pelajaran: mataPelajaran,
                                fase: fase,
                                element: element,
                            }),
                            success: function (response) {
                                if (response.status === "success") {
                                    $("#subelemen").prop("disabled", false);
                                    response.data.forEach(function (item) {
                                        $("#subelemen").append(
                                            new Option(
                                                item.subelemen,
                                                item.subelemen
                                            )
                                        );
                                    });
                                }
                            },
                        });
                    }
                });

                // Fetch Capaian Pembelajaran based on Sub Element
                $("#subelemen").on("change", function () {
                    let mataPelajaran = $("#mata-pelajaran").val();
                    let fase = $("#fase").val();
                    let element = $("#element").val();
                    let subelemen = $(this).val();

                    if (mataPelajaran && fase && element && subelemen) {
                        $.ajax({
                            url: API_URL + "/capaian-pembelajaran/subelement",
                            method: "POST",
                            contentType: "application/json",
                            data: JSON.stringify({
                                mata_pelajaran: mataPelajaran,
                                fase: fase,
                                element: element,
                                subelemen: subelemen,
                            }),
                            success: function (response) {
                                if (response.status === "success") {
                                    $("#capaian-pembelajaran").val(
                                        response.data[0].capaian_pembelajaran
                                    );
                                } else {
                                    $("#capaian-pembelajaran").val(
                                        "No data available"
                                    );
                                }
                            },
                        });
                    }
                });
            });
        </script>
    </body>
</html>
